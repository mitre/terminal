<script src="/gui/js/shared.js"></script>
 <html>
     <head>
         <title>Terminal | Options</title>
         <link rel="shortcut icon" type="image/png" href="/gui/img/favicon.png"/>
         <link rel="stylesheet" href="/gui/css/shared.css">
         <link rel="stylesheet" href="/gui/css/navbar.css">
         <link rel="stylesheet" href="/gui/css/basic.css">
         <link rel="stylesheet" href="/gui/css/modal.css">
     </head>
     <body>
     <div class="navbar">
         <a href="/">Home</a>
         <a href="/logout" style="float:right">Logout</a>
     </div>
     <center style="margin-bottom: 100px">
         <div>
             <div id="sandcat-blocks" class="row-canvas">
                 <div class="section-profile">
                     <div class="row">
                         <div class="topright duk-icon"><img onclick="openLocalDuk()" src="/gui/img/duk.png"></div>
                         <div class="column section-border" style="flex:25%;text-align:left;padding:15px;">
                             <h1 style="font-size:70px;margin-top:-20px;">Terminal</h1>
                             <h2 style="margin-top:-55px">reverse-shell operations</h2>
                             <p>
                                 The terminal plugin gives you the power of reverse-shells. Through these shells you
                                 can manually interact with any host.
                             </p>
                             <br>
                             <select id="session-id">
                               <option value="" disabled selected>Select a session</option>
                               {% for s in sessions %}
                                   <option value="{{ s.id }}">{{ s.id }} - {{ s.info }}</option>
                               {% endfor %}}
                             </select>
                         </div>
                         <div class="column ttp-template" style="flex:75%;padding:15px;text-align: left">
                             <h2 id="session-host"></h2>
                             <input id="session-cmd" type="text" placeholder="enter a command"/>
                             <textarea id="session-reply" placeholder="response will show up here"></textarea>
                             <br>
                             <button type="button" class="button-success atomic-button"
                                     style="width:25%" onclick="sendCommand()">
                                  Send
                             </button>
                         </div>
                     </div>
                 </div>
             </div>
         </div>

         <div id="duk-modal" class="modal">
            <form class="modal-content">
                <div class="container">
                    <div class="row duk-modal">
                        <span onclick="document.getElementById('duk-modal').style.display='none'" class="close" title="Close Modal">&times;</span>
                        <div class="column" style="flex:8%">
                            <img src="/gui/img/duk.png"/>
                        </div>
                        <div class="column" style="flex:92%">
                            <p id="duk-text" style="color: white"></p>
                        </div>
                    </div>
                </div>
             </form>
          </div>

         </center>
     </body>
     <script src="/gui/jquery/jquery.js"></script>
     <script>
         let loc = location.hostname+':8765';
         function sendCommand() {
             let sessionId = $('#session-id option:selected').attr('value');
             let cmd = $('#session-cmd').val();

             let socket = new WebSocket('ws://www.'+loc+'/'+sessionId);
             socket.onopen = function () {
                 socket.send(cmd);
             };
             socket.onmessage = function (s) {
                 $('#session-reply').text(s.data);
             };
         }

         function openLocalDuk() {
             document.getElementById("duk-modal").style.display="block";
            $('#duk-text').text('Did you know... you can deploy a new reverse-shell by running an operation using ' +
                'the terminal adversary. Make sure you also use the terminal facts, which contain the location of the ' +
                'TCP socket. You will need to update this value if you are running anywhere but localhost.');
         }
     </script>
 </html>